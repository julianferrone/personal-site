{{ define "main" }}
<article class="layouts/_default/single.html">
    {{ $series := .Params.Series }}
    {{ $headings := .Fragments.HeadingsMap }}
    {{ if (or $series $headings) }}
    <section class="preface">
        {{ if $series }}
        {{ $seriesPosts := sort (index .Site.Taxonomies.series $series) "PublishDate" "asc"}}
        {{ if gt ($seriesPosts | len) 1}}
        <div id="series">
            <h2>In This Series</h2>
            <ol>
                {{ $currentPage := . }}
                {{ range $seriesPosts }}
                <li class="series-post">
                    {{ if not (.Eq $currentPage) }}
                    <a href="{{ .RelPermalink }}">{{ .Title }}</a>
                    {{ else }}
                    <span class="current">{{ .Title }}</span>
                    {{ end }}
                </li>
                {{ end }}
            </ol>
        </div>
        {{ end }}
        {{ end }}
        {{ if $headings }}
        <div id="contents">
            <h2>Contents</h2>
            {{ .TableOfContents }}
        </div>
        {{ end }}
    </section>
    {{ .Content }}
    {{ end }}
</article>
{{ end }}
