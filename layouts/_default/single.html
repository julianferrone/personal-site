{{ define "main" }}
<article class="layouts/_default/single.html">
    {{ $series := .Params.Series }}
    {{ $headings := .Fragments.HeadingsMap }}
    {{ if (or $series $headings) }}
    <section class="preface">
        {{ if $series }}
        {{ $series_posts := sort (index .Site.Taxonomies.series $series) "PublishDate" "asc"}}
        {{ if gt ($series_posts | len) 1}}
        <div id="series">
            <h2>In This Series</h2>
            <ol>
                {{ range $series_posts }}
                {{ .Render "series_row" }}
                {{ end }}
            </ol>
        </div>
        {{ end }}
        {{ end }}
        {{ if $headings }}
        <div id="contents">
            <h2>Contents</h2>
            {{ .TableOfContents }}
        </div>
        {{ end }}
    </section>
    {{ end }}
    {{ .Content }}
    {{ partial "comments.html" . }}
</article>
{{ end }}
