name: Publish blog
on:
  push:
    branches:
      - 'main'
  schedule:
    # * is a special character in YAML so you have to quote this string
    # 4:30 pm UTC is 2:30 am Sydney time
    # This allows me to schedule posts
    - cron:  '30 16 * * *'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up hugo
        run: |
          # The snap store is currently having issues with Hugo so migrating to 
          # install from the edge channel
          # https://discourse.gohugo.io/t/what-happened-to-the-hugo-snap-store-ubuntu/56580
          sudo snap install --edge hugo
          hugo version
      - name: Generate static site üìÑ
        run: hugo
      - name: Set up SCP üîë
        run: |
          mkdir -v -m 700 $HOME/.ssh
          ssh-keyscan -H ${{ secrets.HOST }} > $HOME/.ssh/known_hosts
          echo "${{ secrets.PRIVATE_KEY }}" > $HOME/.ssh/id_rsa
          chmod 400 $HOME/.ssh/id_rsa
      - name: Upload to server ‚¨ÜÔ∏è
        env:
          user: ${{ secrets.USER }}
          host: ${{ secrets.HOST }}
        run: |
          rsync --delete --archive public/ "${user}@${host}:/var/www/julianferrone.com/"
