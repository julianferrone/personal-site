name: Publish blog
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up hugo
        run: |
          sudo apt update
          sudo apt upgrade
          sudo apt install -y hugo
          hugo version
      - name: Generate static site üìÑ
        run: hugo
      - name: Set up SCP üîë
        run: |
          mkdir -v -m 700 $HOME/.ssh
          ssh-keyscan -H ${{ secrets.HOST }} > $HOME/.ssh/known_hosts
          echo "${{ secrets.PRIVATE_KEY }}" > $HOME/.ssh/id_rsa
          chmod 400 $HOME/.ssh/id_rsa
      - name: Upload to server ‚¨ÜÔ∏è
        env:
          user: ${{ secrets.USER }}
          host: ${{ secrets.HOST }}
        run: |
          rsync --delete --archive public/ "${user}@${host}:/var/www/julianferrone.com/"
