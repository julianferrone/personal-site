name: scp files
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Set up hugo
        run: sudo apt install -y hugo
      - name: Generate static site üìÑ
        run: hugo
      - name: Check static site
        run: HUGO_MINIFY_TDEWOLFF_HTML_KEEPCOMMENTS=true HUGO_ENABLEMISSINGTRANSLATIONPLACEHOLDERS=true hugo && grep -inorE "<\!-- raw HTML omitted -->|ZgotmplZ|\[i18n\]|\(<nil>\)|(&lt;nil&gt;)|hahahugo" public/
      - name: Set up SCP üîë
        run: |
          mkdir -v -m 700 $HOME/.ssh
          ssh-keyscan -H ${{ secrets.HOST }} > $HOME/.ssh/known_hosts
          echo "${{ secrets.PRIVATE_KEY }}" > $HOME/.ssh/id_rsa
          chmod 400 $HOME/.ssh/id_rsa
      - name: Upload to server ‚¨ÜÔ∏è
        env:
          user: ${{ secrets.USER }}
          host: ${{ secrets.HOST }}
        run: |
          scp -i "$HOME/.ssh/id_rsa" -r public/* "$user@$host:/var/www/julianferrone.com"
